# ATOMS3R-CAM Gyazo アップローダー開発記録

## 2025-10-20: プロジェクト開始
- ATOMS3R-CAM で連写した画像を GIF にして Gyazo へアップロードするアイデアからスタート。
- `gifenc` ライブラリを導入し、PlatformIO でビルドできる素振りを確認。

## 2025-10-21 (午前): 初期 GIF 実装
- カメラから RGB565 のフレームを取得し、3-3-2 パレットで 8bit GIF に変換する実装を作成。
- 連写用に `captureBurstGif()` を追加し、LittleFS へ GIF を保存後 Gyazo へアップロードする流れを構築。
- ビルドは通ったが、実機では GIF が壊れて表示されない問題が発生。

## 2025-10-21 (午後): RGB→JPEG アップロードに縮小
- 問題切り分けのため、一時的に GIF 生成を外して単体の JPEG を Gyazo へアップロードする実装へ変更。
- Wi-Fi (WPA2-Enterprise) の接続処理やアップロード用の HTTPS 通信を整備。
- JPEG のアップロードは成功を確認。

## 2025-10-21 (夕方): GIF 再挑戦
- GIF 用に RGB565 を 160x120/256色へ縮小量子化する処理を復活。
- しかしハードウェアログが多く `cam_task` のスタックカナリアが発火したため、ESP-IDF のログレベルを抑制。
- LittleFS のマウントやフレーム管理周りを整理。
- 依然として GIF は色がおかしい (ノイズ化) 問題が残る。

## 2025-10-21 (夜): GIF 色調整と JPEG 併用
- Gyazo に JPEG と GIF の両方をアップロードする設計に変更。10 秒ごとに JPEG をアップロードし、複数フレームを蓄積したら GIF 生成。
- `fmt2rgb888()` を用いて RGB565 を正確な RGB888 に変換し、160x120 へ縮小。
- GIF は中央値分割 (median-cut) による 256 色パレットを動的生成する実装へ。色ノイズは大幅に減少。
- LZW の CLEAR コードを定期的に挿入するよう `gifenc` を改善し、辞書サイズ問題を回避。

## 2025-10-21 (夜遅く): GIF 再生速度とフレーム数調整
- Gyazo 上での GIF 再生が 10 秒/フレームと遅かったため、再生ディレイのみを 200ms に短縮 (撮影方向の間隔は 10 秒のまま)。
- GIF 生成フレーム数を 5 枚に拡張し、より滑らかなアニメーションに。
- 青みがかっていたフレームを BGR→RGB の入れ替えで修正。

## 2025-10-21 (深夜): README とまとめ
- README を最新仕様 (10 秒ごと JPEG、5 枚で GIF、`GIF_FRAME_DELAY_MS` で再生速度調整) に更新。
- BLOG.md を作成し、ここまでの変更履歴を整理。

### 今後のアイデア
- 撮影間隔や GIF フレーム数を Web UI などからダイナミックに変更できるようにする。
- Gyazo のレスポンス JSON から URL を抽出して表示端末へ共有する機能追加。
- センサー側での露出やホワイトバランス調整を行い、室内・屋外での色再現性を向上させる。

